# 低代码平台 (Low-Code Platform) 规划文档

> **版本**: v0.1.0-draft | **日期**: 2026-02-05 | **基于**: plumego v1.0.0-rc.1

---

## 一、概述

本文档规划基于 plumego 框架构建的企业级低代码平台，旨在提供可视化开发、快速应用构建和灵活扩展能力。

### 1.1 低代码平台定位

- **目标用户**: 企业内部开发者、业务分析师、技术主管
- **核心价值**: 降低开发门槛、提升交付速度、标准化应用架构
- **应用场景**: 内部管理系统、数据看板、工作流自动化、API编排

### 1.2 架构原则

- 基于 plumego 的标准库优先设计理念
- 元数据驱动的动态应用生成
- 插件化、可扩展的组件体系
- 多租户隔离与安全保障

---

## 二、低代码平台核心功能模块

### 2.1 可视化设计器层 (Designer Layer)

#### 2.1.1 表单设计器 (Form Designer)
**功能描述**: 拖拽式表单构建，支持动态字段、验证规则、布局配置

**核心能力**:
- 字段类型库 (文本、数字、日期、下拉、文件上传等)
- 字段验证规则 (必填、正则、自定义函数)
- 条件显示逻辑 (基于其他字段值控制显隐)
- 表单布局引擎 (网格、分组、步骤表单)
- 表单模板库

**技术要求**:
- JSON Schema 定义表单结构
- 客户端实时预览
- 版本控制与发布机制

#### 2.1.2 页面设计器 (Page Designer)
**功能描述**: 可视化页面布局，组件拖拽、数据绑定

**核心能力**:
- 组件库 (表格、图表、卡片、导航、布局容器)
- 数据源绑定 (API、数据库查询、静态数据)
- 事件处理配置 (点击、提交、加载)
- 响应式布局支持
- 主题与样式系统

**技术要求**:
- 组件元数据定义 (props、events、slots)
- 数据绑定表达式引擎
- 前端渲染框架集成 (Vue/React)

#### 2.1.3 流程设计器 (Workflow Designer)
**功能描述**: 可视化业务流程编排，支持审批、条件分支、定时任务

**核心能力**:
- BPMN 2.0 标准流程建模
- 节点类型 (开始、结束、任务、网关、子流程)
- 条件表达式配置
- 任务分配策略 (用户、角色、部门)
- 流程实例监控与追踪

**技术要求**:
- 流程定义存储与版本管理
- 流程引擎执行
- 事件驱动架构

#### 2.1.4 数据模型设计器 (Data Model Designer)
**功能描述**: 可视化数据表结构设计，关系定义

**核心能力**:
- 实体 (Entity) 定义与字段配置
- 关系映射 (一对一、一对多、多对多)
- 索引与约束配置
- 数据迁移脚本生成
- ER 图可视化

**技术要求**:
- Schema 元数据管理
- 数据库迁移工具集成
- 跨数据库兼容性

#### 2.1.5 API 设计器 (API Designer)
**功能描述**: 可视化 API 编排与配置

**核心能力**:
- RESTful API 端点定义
- 请求/响应 Schema 配置
- 数据转换与映射
- API 编排 (多步骤调用、聚合)
- Mock 数据生成

---

### 2.2 数据管理层 (Data Layer)

#### 2.2.1 元数据引擎 (Metadata Engine)
**功能描述**: 存储和管理所有设计元数据

**核心能力**:
- 统一元数据模型 (entities, forms, pages, workflows, apis)
- 元数据版本控制
- 元数据查询 API
- 元数据导入/导出

**存储需求**:
- 关系型数据库存储元数据
- 缓存热点元数据
- 元数据变更事件发布

#### 2.2.2 动态数据模型 (Dynamic Data Model)
**功能描述**: 基于元数据动态创建数据表和 CRUD 操作

**核心能力**:
- 动态表创建/修改/删除
- 通用 CRUD API 生成
- 数据验证引擎
- 数据关系处理
- 软删除与审计日志

**技术要求**:
- SQL 生成器
- ORM 抽象层
- 数据访问权限控制

#### 2.2.3 文件存储 (File Storage)
**功能描述**: 支持附件上传、图片管理

**核心能力**:
- 本地/云存储适配器 (S3, OSS, MinIO)
- 文件预览与缩略图生成
- 访问权限控制
- 文件版本管理

---

### 2.3 业务逻辑层 (Business Logic Layer)

#### 2.3.1 工作流引擎 (Workflow Engine)
**功能描述**: 执行流程定义，管理流程实例

**核心能力**:
- 流程实例生命周期管理
- 任务分配与执行
- 并行网关与条件分支
- 子流程与嵌套流程
- 流程监控与统计
- 超时与补偿机制

**技术要求**:
- 状态机实现
- 任务队列 (基于 plumego scheduler)
- 事件驱动通知

#### 2.3.2 规则引擎 (Rule Engine)
**功能描述**: 执行业务规则和条件表达式

**核心能力**:
- 规则定义 DSL (Domain Specific Language)
- 条件表达式求值
- 规则链执行
- 规则优先级管理
- 规则测试与调试

**技术要求**:
- 表达式解析器
- 规则缓存
- 规则变更热加载

#### 2.3.3 脚本执行引擎 (Script Engine)
**功能描述**: 支持自定义业务逻辑脚本

**核心能力**:
- JavaScript/Lua 脚本执行
- 沙箱隔离
- API 调用支持
- 脚本库管理
- 执行超时控制

**技术要求**:
- 脚本解释器集成 (goja, gopher-lua)
- 上下文注入
- 资源限制

#### 2.3.4 数据验证引擎 (Validation Engine)
**功能描述**: 统一的数据验证框架

**核心能力**:
- 内置验证规则库
- 自定义验证函数
- 跨字段验证
- 异步验证 (唯一性检查、远程验证)
- 验证错误国际化

---

### 2.4 权限与安全层 (Security Layer)

#### 2.4.1 RBAC 权限控制 (Role-Based Access Control)
**功能描述**: 基于角色的访问控制

**核心能力**:
- 用户-角色-权限模型
- 资源权限定义 (菜单、页面、按钮、API)
- 角色继承
- 权限动态校验
- 权限缓存

#### 2.4.2 数据级权限 (Data-Level Permissions)
**功能描述**: 行级、列级数据访问控制

**核心能力**:
- 数据过滤规则 (按部门、创建人等)
- 敏感字段脱敏
- 数据范围控制
- 动态权限计算

#### 2.4.3 审计日志 (Audit Log)
**功能描述**: 记录所有关键操作

**核心能力**:
- 操作日志记录 (创建、修改、删除、查看)
- 用户行为追踪
- 数据变更历史
- 日志查询与导出
- 敏感操作告警

---

### 2.5 前端渲染层 (Frontend Layer)

#### 2.5.1 表单渲染引擎 (Form Renderer)
**功能描述**: 基于 JSON Schema 渲染表单

**核心能力**:
- Schema 到 UI 组件映射
- 动态表单生成
- 表单验证集成
- 自定义组件扩展

#### 2.5.2 页面渲染引擎 (Page Renderer)
**功能描述**: 基于页面配置渲染界面

**核心能力**:
- 组件树渲染
- 数据绑定与响应式更新
- 事件处理
- 插槽与嵌套组件

#### 2.5.3 组件库 (Component Library)
**功能描述**: 预置UI组件集合

**组件类型**:
- 基础组件 (按钮、输入框、选择器)
- 数据展示 (表格、列表、树)
- 图表组件 (折线图、柱状图、饼图)
- 布局组件 (栅格、容器、分栏)
- 业务组件 (用户选择器、部门选择器)

#### 2.5.4 主题系统 (Theme System)
**功能描述**: 可定制的视觉主题

**核心能力**:
- 主题变量管理
- 深色/浅色模式
- 品牌颜色配置
- 组件样式覆盖

---

### 2.6 集成能力层 (Integration Layer)

#### 2.6.1 REST API 集成 (REST API Integration)
**功能描述**: 集成外部 REST API

**核心能力**:
- API 配置管理 (URL、认证、请求头)
- 请求/响应映射
- 错误处理与重试
- API 测试工具

#### 2.6.2 数据库连接 (Database Connection)
**功能描述**: 连接多种数据库

**核心能力**:
- 支持 MySQL, PostgreSQL, SQLite
- 数据源池化管理
- SQL 查询构建器
- 读写分离

#### 2.6.3 消息队列集成 (Message Queue Integration)
**功能描述**: 异步任务处理

**核心能力**:
- 支持 Redis、RabbitMQ
- 任务发布与订阅
- 任务重试与死信队列
- 任务监控

#### 2.6.4 Webhook 集成
**功能描述**: 入站/出站 Webhook 管理

**核心能力**:
- Webhook 接收与验证
- Webhook 触发配置
- 签名验证
- 交付重试

---

### 2.7 运行时环境层 (Runtime Layer)

#### 2.7.1 应用发布 (App Deployment)
**功能描述**: 应用的构建与发布

**核心能力**:
- 应用打包
- 版本管理
- 灰度发布
- 回滚机制

#### 2.7.2 多租户支持 (Multi-Tenancy)
**功能描述**: SaaS 模式租户隔离

**核心能力**:
- 租户配置管理
- 数据隔离
- 租户配额控制
- 计费与监控

#### 2.7.3 性能监控 (Performance Monitoring)
**功能描述**: 应用性能监控

**核心能力**:
- 请求追踪
- 慢查询分析
- 错误率监控
- 资源使用统计

#### 2.7.4 日志管理 (Log Management)
**功能描述**: 集中式日志收集

**核心能力**:
- 结构化日志
- 日志聚合
- 日志搜索
- 日志归档

---

## 三、Plumego 现有能力映射

### 3.1 已具备的核心能力 ✅

| 功能模块 | Plumego 能力 | 覆盖程度 | 说明 |
|---------|------------|---------|------|
| **HTTP 路由** | `router/` 包 | 100% | Trie-based路由，支持路径参数、路由组 |
| **中间件链** | `middleware/` 包 | 100% | 日志、恢复、CORS、限流、并发控制 |
| **安全机制** | `security/` 包 | 90% | JWT、密码哈希、输入验证、安全头 |
| **多租户** | `tenant/` 包 | 100% | 配额管理、策略控制、数据库隔离 |
| **任务调度** | `scheduler/` 包 | 100% | Cron、延迟任务、重试策略 |
| **Pub/Sub** | `pubsub/` 包 | 100% | 进程内消息分发、优先级、去重 |
| **WebSocket** | `net/websocket/` | 100% | Hub管理、JWT认证、房间管理 |
| **Webhook** | `net/webhookin/`, `webhookout/` | 100% | 签名验证、交付重试 |
| **健康检查** | `health/` 包 | 100% | 就绪探测、健康状态 |
| **日志系统** | `log/` 包 | 100% | 结构化日志、日志钩子 |
| **指标收集** | `metrics/` 包 | 100% | Prometheus、OpenTelemetry |
| **配置管理** | `config/` 包 | 100% | 环境变量、热重载、验证 |
| **数据库抽象** | `store/db/` | 80% | `database/sql` 封装、租户DB |
| **缓存** | `store/cache/` | 80% | Redis、LRU缓存 |
| **KV存储** | `store/kv/` | 70% | 嵌入式KV、WAL |
| **静态文件** | `frontend/` 包 | 100% | 静态资源服务、嵌入式资源 |
| **验证器** | `validator/` 包 | 90% | 请求验证、结构体验证 |
| **AI Gateway** | `ai/` 包 | 100% | LLM提供商、会话管理、工具调用 |
| **错误处理** | `contract/` 包 | 100% | 结构化错误、错误分类 |

### 3.2 部分具备的能力 🔶

| 功能需求 | Plumego 当前状态 | 缺失部分 | 优先级 |
|---------|-----------------|---------|-------|
| **数据模型管理** | 有 `store/db/` 基础抽象 | 缺少动态表创建、Schema迁移工具 | 高 |
| **文件存储** | 无专用模块 | 需要文件上传、云存储适配器 | 高 |
| **规则引擎** | 无 | 需要表达式解析、规则执行引擎 | 中 |
| **脚本引擎** | 无 | 需要脚本解释器、沙箱 | 中 |
| **RBAC** | 有 `security/jwt/` 基础 | 缺少完整的权限模型存储与校验 | 高 |
| **审计日志** | 有日志基础 | 缺少审计专用模型与查询 | 中 |

### 3.3 完全缺失的能力 ❌

| 功能需求 | 说明 | 优先级 | 复杂度 |
|---------|-----|-------|-------|
| **表单设计器** | 可视化表单构建器，前端主导 | 高 | 高 |
| **页面设计器** | 拖拽式页面编辑器 | 高 | 高 |
| **流程设计器** | BPMN流程建模工具 | 中 | 高 |
| **数据模型设计器** | ER图编辑器 | 高 | 中 |
| **API设计器** | 可视化API配置 | 中 | 中 |
| **工作流引擎** | BPMN流程执行引擎 | 高 | 高 |
| **表单渲染引擎** | 前端JSON Schema渲染 | 高 | 中 |
| **页面渲染引擎** | 前端组件树渲染 | 高 | 高 |
| **组件库** | 预置UI组件集合 | 高 | 中 |
| **主题系统** | 可定制主题 | 低 | 低 |
| **数据级权限** | 行列级权限控制 | 中 | 中 |

---

## 四、Plumego 需要补齐的功能

### 4.1 核心缺失模块（必须实现）

#### 4.1.1 元数据管理模块 (Metadata Module)
**路径**: `lowcode/metadata/`

**功能**:
- 元数据 CRUD API
- 元数据版本控制
- 元数据验证
- 元数据导入/导出

**依赖**: `store/db/`, `validator/`

**预估工作量**: 2-3周

---

#### 4.1.2 动态数据模型模块 (Dynamic Model Module)
**路径**: `lowcode/model/`

**功能**:
- 基于元数据动态创建表
- 动态 CRUD API 生成器
- 数据验证引擎集成
- 关系数据查询

**依赖**: `store/db/`, `validator/`, `lowcode/metadata/`

**预估工作量**: 3-4周

---

#### 4.1.3 表单引擎模块 (Form Engine Module)
**路径**: `lowcode/form/`

**功能**:
- 表单 Schema 定义
- 表单验证规则引擎
- 表单数据处理
- 表单模板管理

**依赖**: `validator/`, `lowcode/metadata/`

**预估工作量**: 2-3周

---

#### 4.1.4 页面引擎模块 (Page Engine Module)
**路径**: `lowcode/page/`

**功能**:
- 页面配置存储
- 数据源绑定管理
- 页面权限控制
- 页面版本管理

**依赖**: `lowcode/metadata/`, `security/`

**预估工作量**: 2-3周

---

#### 4.1.5 工作流引擎模块 (Workflow Engine Module)
**路径**: `lowcode/workflow/`

**功能**:
- 流程定义解析
- 流程实例管理
- 任务分配与执行
- 流程监控

**依赖**: `scheduler/`, `pubsub/`, `store/db/`

**预估工作量**: 4-6周

---

#### 4.1.6 规则引擎模块 (Rule Engine Module)
**路径**: `lowcode/rule/`

**功能**:
- 规则 DSL 定义
- 表达式解析器
- 规则执行引擎
- 规则优先级管理

**依赖**: 第三方表达式库 (govaluate, expr)

**预估工作量**: 2-3周

---

#### 4.1.7 文件存储模块 (File Storage Module)
**路径**: `lowcode/storage/`

**功能**:
- 本地文件存储
- S3/OSS 适配器
- 文件预览与缩略图
- 访问权限控制

**依赖**: `security/`, 第三方SDK

**预估工作量**: 2周

---

#### 4.1.8 RBAC 权限模块 (RBAC Module)
**路径**: `lowcode/rbac/`

**功能**:
- 用户-角色-权限模型
- 权限检查中间件
- 动态权限配置
- 权限缓存

**依赖**: `store/db/`, `store/cache/`, `security/jwt/`

**预估工作量**: 3-4周

---

### 4.2 增强型模块（可选实现）

#### 4.2.1 脚本引擎模块 (Script Engine Module)
**路径**: `lowcode/script/`

**功能**:
- JavaScript/Lua 脚本执行
- 沙箱环境
- API 调用支持

**依赖**: goja, gopher-lua

**预估工作量**: 3-4周

---

#### 4.2.2 数据级权限模块 (Data Permission Module)
**路径**: `lowcode/dataperm/`

**功能**:
- 行级数据过滤
- 列级字段脱敏
- 动态权限计算

**依赖**: `lowcode/rbac/`, `store/db/`

**预估工作量**: 2-3周

---

#### 4.2.3 审计日志模块 (Audit Module)
**路径**: `lowcode/audit/`

**功能**:
- 操作日志记录
- 数据变更历史
- 日志查询 API

**依赖**: `log/`, `store/db/`

**预估工作量**: 1-2周

---

#### 4.2.4 API 编排模块 (API Orchestration Module)
**路径**: `lowcode/apiorchestration/`

**功能**:
- API 编排配置
- 多步骤调用
- 数据转换与聚合

**依赖**: `net/http/`, `lowcode/rule/`

**预估工作量**: 3周

---

### 4.3 前端模块（独立实现）

前端设计器和渲染器通常基于 Vue/React，独立于 plumego 后端：

#### 4.3.1 表单设计器 (Form Designer Frontend)
- 技术栈: Vue 3 + Element Plus / React + Ant Design
- 功能: 拖拽、配置面板、实时预览
- 工作量: 4-6周

#### 4.3.2 页面设计器 (Page Designer Frontend)
- 技术栈: Vue 3 + VueUse / React + DND Kit
- 功能: 组件拖拽、属性配置、数据绑定
- 工作量: 6-8周

#### 4.3.3 流程设计器 (Workflow Designer Frontend)
- 技术栈: bpmn-js, X6, LogicFlow
- 功能: BPMN 建模、节点配置
- 工作量: 4-6周

#### 4.3.4 表单/页面渲染器 (Renderer Frontend)
- 技术栈: Vue 3 / React
- 功能: JSON Schema 渲染、数据绑定
- 工作量: 3-4周

#### 4.3.5 管理后台 (Admin Dashboard)
- 技术栈: Vue 3 + Element Plus / React + Ant Design Pro
- 功能: 应用管理、用户管理、权限配置、监控
- 工作量: 4-6周

---

## 五、实施路线图

### 阶段一: 基础设施 (4-6周)

**目标**: 搭建低代码平台的核心基础设施

**任务**:
1. ✅ 元数据管理模块 (`lowcode/metadata/`)
2. ✅ 动态数据模型模块 (`lowcode/model/`)
3. ✅ 文件存储模块 (`lowcode/storage/`)
4. ✅ RBAC 权限模块 (`lowcode/rbac/`)

**交付物**:
- 元数据 CRUD API
- 动态表创建与数据操作 API
- 文件上传/下载 API
- 基础权限控制中间件

**验收标准**:
- 能够通过 API 创建实体定义并自动生成数据表
- 文件上传支持本地和 S3
- RBAC 中间件正确拦截无权限请求

---

### 阶段二: 表单与页面引擎 (4-6周)

**目标**: 实现表单和页面的后端引擎

**任务**:
1. ✅ 表单引擎模块 (`lowcode/form/`)
2. ✅ 页面引擎模块 (`lowcode/page/`)
3. ✅ 规则引擎模块 (`lowcode/rule/`)
4. 🔶 前端表单渲染器 (基础版)

**交付物**:
- 表单 Schema 定义与验证 API
- 页面配置存储与查询 API
- 规则表达式执行引擎
- 基础表单渲染器 (Vue 3)

**验收标准**:
- 后端能够存储和返回表单/页面配置
- 前端渲染器能够根据 JSON Schema 渲染表单
- 规则引擎能够执行条件表达式

---

### 阶段三: 工作流引擎 (4-6周)

**目标**: 实现业务流程自动化

**任务**:
1. ✅ 工作流引擎模块 (`lowcode/workflow/`)
2. ✅ 审计日志模块 (`lowcode/audit/`)
3. 🔶 流程设计器前端 (基础版)

**交付物**:
- 流程定义解析器
- 流程实例执行引擎
- 任务分配与流转 API
- 流程监控 API
- 基础流程设计器 (bpmn-js)

**验收标准**:
- 能够定义和执行简单审批流程
- 流程实例状态正确流转
- 任务能够分配给用户并完成

---

### 阶段四: 可视化设计器 (6-8周)

**目标**: 提供完整的可视化开发体验

**任务**:
1. ✅ 表单设计器前端
2. ✅ 页面设计器前端
3. ✅ 数据模型设计器前端
4. ✅ 管理后台

**交付物**:
- 拖拽式表单设计器
- 拖拽式页面设计器
- ER 图数据模型设计器
- 完整管理后台界面

**验收标准**:
- 业务人员能够通过拖拽创建表单和页面
- 设计器生成的配置能够正确渲染
- 管理后台能够管理应用和用户

---

### 阶段五: 高级功能 (4-6周)

**目标**: 增强平台能力

**任务**:
1. ✅ 脚本引擎模块 (`lowcode/script/`)
2. ✅ 数据级权限模块 (`lowcode/dataperm/`)
3. ✅ API 编排模块 (`lowcode/apiorchestration/`)
4. ✅ 性能优化与监控

**交付物**:
- JavaScript 脚本执行环境
- 行列级数据权限控制
- API 编排配置与执行
- 性能监控看板

**验收标准**:
- 脚本能够安全执行并调用系统 API
- 数据权限能够正确过滤查询结果
- API 编排能够执行多步骤调用

---

### 阶段六: 生产化与优化 (持续)

**目标**: 平台稳定性与性能优化

**任务**:
1. 性能测试与优化
2. 安全加固
3. 文档完善
4. 示例应用
5. 部署与运维工具

**交付物**:
- 性能测试报告
- 安全审计报告
- 完整开发文档
- 3-5个示例应用
- Docker 部署方案

---

## 六、技术选型建议

### 6.1 后端技术栈

| 模块 | 技术选型 | 说明 |
|-----|---------|------|
| 核心框架 | Plumego v1.0+ | 基于标准库 |
| 数据库 | PostgreSQL 14+ | 支持 JSON 字段、全文搜索 |
| 缓存 | Redis 6+ | 权限缓存、会话存储 |
| 消息队列 | plumego pubsub (开发环境) / Redis Streams (生产) | 异步任务 |
| 文件存储 | 本地存储 / S3-compatible | MinIO, AWS S3, 阿里云 OSS |
| 表达式引擎 | [expr](https://github.com/antonmedv/expr) | 规则引擎表达式 |
| 脚本引擎 | [goja](https://github.com/dop251/goja) (JS) | 自定义逻辑脚本 |
| 工作流 | 自研基于状态机 + plumego scheduler | 轻量级流程引擎 |

### 6.2 前端技术栈

| 模块 | 技术选型 | 说明 |
|-----|---------|------|
| 框架 | Vue 3 + TypeScript | 响应式、组合式 API |
| UI 组件库 | Element Plus / Ant Design Vue | 企业级组件 |
| 状态管理 | Pinia | Vue 官方推荐 |
| 表单设计器 | form-create / Formily | 拖拽表单构建 |
| 页面设计器 | 自研 / vue-grid-layout | 拖拽布局 |
| 流程设计器 | bpmn-js / LogicFlow | BPMN 标准 |
| 图表库 | ECharts / Apache ECharts | 数据可视化 |
| 请求库 | Axios | HTTP 客户端 |
| 构建工具 | Vite | 快速开发构建 |

### 6.3 第三方库依赖

**后端新增依赖**:
```go
// 表达式引擎
github.com/antonmedv/expr v1.15+

// JavaScript 脚本引擎
github.com/dop251/goja v0.0.0-latest

// S3 兼容存储
github.com/minio/minio-go/v7 v7.0+

// Schema 迁移
github.com/golang-migrate/migrate/v4 v4.15+
```

**前端新增依赖**:
```json
{
  "vue": "^3.4.0",
  "element-plus": "^2.5.0",
  "pinia": "^2.1.0",
  "axios": "^1.6.0",
  "echarts": "^5.5.0",
  "bpmn-js": "^17.0.0"
}
```

---

## 七、关键技术挑战

### 7.1 元数据驱动的动态性

**挑战**: 如何设计灵活的元数据模型，同时保证性能和类型安全？

**解决方案**:
- 元数据采用 JSON Schema 标准
- 缓存热点元数据到 Redis
- 使用 PostgreSQL JSONB 字段存储灵活配置
- 编译期生成代码优化性能

### 7.2 动态表创建与迁移

**挑战**: 用户修改数据模型时如何安全地迁移数据？

**解决方案**:
- 使用 `golang-migrate` 生成迁移脚本
- 版本化 Schema 变更
- 提供数据迁移预览
- 支持回滚机制

### 7.3 通用 CRUD API 生成

**挑战**: 如何自动生成高性能、安全的 CRUD API？

**解决方案**:
- 使用 SQL Builder 动态构建查询
- 集成 plumego validator 进行验证
- 自动注入租户过滤和权限检查
- 生成 OpenAPI 文档

### 7.4 前端渲染性能

**挑战**: 复杂页面配置如何高效渲染？

**解决方案**:
- 组件懒加载
- 虚拟滚动 (表格、列表)
- 异步数据加载
- 缓存渲染结果

### 7.5 工作流并发与一致性

**挑战**: 多人同时操作流程实例如何保证一致性？

**解决方案**:
- 使用数据库行锁
- 乐观锁版本控制
- 事件溯源记录状态变更
- 基于 plumego pubsub 的事件通知

### 7.6 权限性能优化

**挑战**: 复杂权限规则如何避免影响响应时间？

**解决方案**:
- Redis 缓存用户权限
- 批量权限检查
- 权限树预计算
- 使用位运算优化权限判断

### 7.7 脚本安全隔离

**挑战**: 用户脚本如何避免影响系统安全和稳定性？

**解决方案**:
- 使用 goja VM 隔离
- 限制可调用的 API 白名单
- 执行超时控制 (5秒)
- 资源配额限制 (内存、CPU)

---

## 八、安全与合规

### 8.1 安全要求

- ✅ 所有 API 需要认证 (JWT)
- ✅ HTTPS 传输 (生产环境)
- ✅ SQL 注入防护 (参数化查询)
- ✅ XSS 防护 (输入转义、CSP)
- ✅ CSRF 防护 (Token 验证)
- ✅ 文件上传类型与大小限制
- ✅ 敏感数据加密存储
- ✅ 审计日志记录

### 8.2 合规要求

- GDPR 数据保护 (数据导出、删除)
- RBAC 最小权限原则
- 密码强度策略
- 会话超时控制
- 数据备份与恢复

---

## 九、测试策略

### 9.1 单元测试

- 覆盖率目标: 80%+
- 使用 `testing` 包和 `testify`
- Mock 数据库和外部依赖

### 9.2 集成测试

- API 端到端测试
- 数据库迁移测试
- 权限控制集成测试

### 9.3 性能测试

- 使用 `go test -bench`
- 并发场景压测 (wrk, ab)
- 数据库查询性能优化

### 9.4 安全测试

- SQL 注入测试
- XSS 攻击测试
- 权限绕过测试

---

## 十、部署方案

### 10.1 单体部署 (小型团队)

```
[Nginx] -> [Plumego App] -> [PostgreSQL]
                         -> [Redis]
                         -> [MinIO]
```

### 10.2 微服务拆分 (大型团队)

```
[API Gateway] -> [Auth Service]
              -> [Metadata Service]
              -> [Workflow Service]
              -> [File Service]
              -> [Rendering Service]
```

### 10.3 容器化部署

```dockerfile
# Dockerfile
FROM golang:1.24-alpine AS builder
WORKDIR /app
COPY . .
RUN go build -o lowcode ./cmd/lowcode

FROM alpine:latest
COPY --from=builder /app/lowcode /usr/local/bin/
CMD ["lowcode"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=postgres://...
      - REDIS_URL=redis://...
    depends_on:
      - postgres
      - redis
      - minio
  postgres:
    image: postgres:14-alpine
  redis:
    image: redis:6-alpine
  minio:
    image: minio/minio
```

---

## 十一、总结

### 11.1 Plumego 优势

✅ **标准库优先**: 轻量级、可维护性高
✅ **多租户内置**: 天然支持 SaaS 模式
✅ **AI Gateway**: 可集成 AI 辅助开发能力
✅ **完善的基础设施**: 认证、限流、监控、日志开箱即用
✅ **组件化架构**: 易于扩展和定制

### 11.2 需要补齐的核心能力

❌ **元数据管理**: 需要实现完整的元数据引擎
❌ **动态数据模型**: 需要动态表创建和迁移工具
❌ **工作流引擎**: 需要自研或集成第三方流程引擎
❌ **规则引擎**: 需要表达式解析和执行能力
❌ **可视化设计器**: 需要前端设计器开发
❌ **前端渲染器**: 需要 JSON Schema 驱动的渲染引擎

### 11.3 开发投入估算

| 阶段 | 工作量 | 人员配置 |
|-----|-------|---------|
| 阶段一 (基础设施) | 4-6周 | 2 后端 |
| 阶段二 (表单/页面引擎) | 4-6周 | 2 后端 + 1 前端 |
| 阶段三 (工作流) | 4-6周 | 2 后端 + 1 前端 |
| 阶段四 (可视化设计器) | 6-8周 | 3 前端 |
| 阶段五 (高级功能) | 4-6周 | 2 后端 + 1 前端 |
| **总计** | **22-32周** | **2-3 后端 + 2-3 前端** |

### 11.4 风险与缓解

| 风险 | 影响 | 缓解措施 |
|-----|-----|---------|
| 动态表性能问题 | 高 | 使用缓存、索引优化、读写分离 |
| 工作流复杂度 | 高 | 先实现简单流程，逐步增强 |
| 前端渲染性能 | 中 | 虚拟滚动、懒加载、组件缓存 |
| 权限规则复杂 | 中 | 使用缓存、预计算权限树 |
| 脚本安全风险 | 高 | 沙箱隔离、白名单、资源限制 |

---

## 十二、下一步行动

### 12.1 立即行动

1. ✅ **评审本规划文档**，确认技术路线
2. ✅ **搭建项目仓库结构** (`lowcode/` 目录)
3. ✅ **创建数据库 Schema** (元数据表设计)
4. ✅ **实现元数据管理模块** (第一个核心模块)

### 12.2 短期目标 (1个月内)

1. 完成阶段一: 基础设施模块
2. 实现动态表创建功能
3. 实现文件上传功能
4. 完成 RBAC 权限中间件

### 12.3 中期目标 (3个月内)

1. 完成阶段二: 表单与页面引擎
2. 完成阶段三: 工作流引擎
3. 实现基础前端渲染器
4. 提供演示应用

### 12.4 长期目标 (6个月内)

1. 完成阶段四: 可视化设计器
2. 完成阶段五: 高级功能
3. 性能优化与安全加固
4. 完整文档与示例

---

**文档维护**: 本文档应随着开发进度持续更新
**反馈渠道**: 通过 GitHub Issues 收集反馈
**版本历史**: 在 Git 提交记录中追踪变更

---

**END OF DOCUMENT**
